<?xml version="1.0" ?>
<TranscendenceModule>

<!-- ======================================================================= -->
							<!-- Ship DockScreens -->							
<!-- ======================================================================= -->

	<!-- Cabbage Corp Toolset -->

	<DockScreen	UNID="&scCCCabbageModification;"
			name=				"Cabbage Corp Toolset"
			desc=				"Equipment Configuration"
			type=				"customItemPicker"
			backgroundID=		"&rsItemListScreen;"
			nestedScreen=		"true"
	>
			
		<Events>
			<OnGlobalPaneInit>
				; aScreenUNID is the UNID of the screen being shown
				; aScreen is the screen name (if this is a local screen)
				; aPane is the pane being shown
				; Action only appears if any item with the Cabbage attribute is installed.
				(if (and
						; If the following list exists then it counts as True
						(filter (objGetItems gPlayership "dI +cabbageCorp") theItem (itmIsKnown theItem))
						(eq aScreenUNID &dsShipInterior;)
						(eq aPane "Default")
					)
					(scrAddAction
						gScreen
						'cabbageCorp
						0
						"Cabbage Corp Toolset"
						"C"
						Nil
						(scrShowScreen gScreen "&scCCCabbageModification;")
					)
				)
			</OnGlobalPaneInit>
		</Events>

		
		<List>
			(filter (objGetItems gPlayership "dI +cabbageCorp") theItem (itmIsKnown theItem))
		</List>

		<Panes>
			<Default
					desc=	"You are viewing the ship's configuration.">

				<OnPaneInit>
					(block (gItem desc)
						(setq gItem (scrGetItem gScreen))

						(if gItem
							(block (theCategory)
								(setq desc (cat "Unit mass: " (strMassString (itmGetMass gItem)) "\n\n"))

								; Describe the item installation
								(setq desc (cat desc (objGetInstalledItemDesc gPlayerShip gItem) "."))
								
								; Display
								(scrSetDesc gScreen desc)
							)
						)
						(scrEnableAction gScreen 0
							(and
								(itmMatches gItem "dN +cabbageCorp;")	; Undamaged Cabbage Corp device
								(ls (itmIsEnhanced gItem) 0x8000)		; Not enhanced with a negative effect
							)
						)
						(scrEnableAction gScreen 1 (not (eq (itmGetStaticData gItem 'CCItemSwap) Nil)))
						(scrEnableAction gScreen 2 (not (eq (itmGetStaticData gItem 'useScreen) Nil)))
					)
				</OnPaneInit>
				<Actions>
					<Action name="Factory Reset" default="1" key="F">
						<ShowPane pane="CCFactoryReset"/>
					</Action>
					
					<Action name="Modify" key="M">
						(block Nil
							(intModifyHardware (itmGetStaticData gItem 'CCItemSwap))
							(scrExitScreen gScreen)
						)
					</Action>
					
					<Action name="Use Equipment" key="U">
						(block Nil
							(scrShowScreen gScreen (itmGetStaticData gItem 'useScreen))
						)
					</Action>
					
					<Action name="Done" cancel="1" key="D">
						(scrExitScreen gScreen)
					</Action>

				</Actions>

			</Default>
			
			<CCFactoryReset
							desc=	"Are you sure you wish to reset your Cabbage Corp device's software to its factory state?  This operation cannot be undone and all current enhancements to the device will be lost.  This will not fix physical alterations or damage to the device and it may compound existing problems.">

				<Actions>
					<Action name="Apply Factory Reset" default="1" key="A">
						(block (currentFuel newDevice baseFuel)
							(setq gItem (scrGetItem gScreen))
							(setq currentFuel (shpGetFuelLeft gSource))
							(setq newDevice (itmCreate (itmGetType gItem) 1))
							
							(shpRemoveDevice gSource gItem)
							(objRemoveItem gSource (itmSetProperty gItem 'installed Nil) 1)
							
							(if (eq (random 1 20) 1)
								(if (itmGetProperty gItem 'disrupted)
									(setq newDevice (itmSetProperty newDevice 'damaged True))
									(setq newDevice (itmSetProperty newDevice 'disrupted True))
								)
							)
							
							(objAddItem gSource newDevice)
							(shpInstallDevice gSource newDevice)
							
							(setq baseFuel (shpGetFuelLeft gSource))
							(shpConsumeFuel gSource (multiply (subtract currentFuel baseFuel) -1))
							(scrExitScreen gScreen)
						)
					</Action>
					
					<Action name="Cancel" cancel="1" key="C">
						(scrExitScreen gScreen)
					</Action>

				</Actions>
			</CCFactoryReset>
		</Panes>
	</DockScreen>

</TranscendenceModule>